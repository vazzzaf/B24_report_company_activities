# B24_report_company_activities

ОПИСАНИЕ.
В CRM Битрикс24 (облако) имеются следующие сущности: компании, контакты и сделки. Логика Битрикс24 построена таким образом, что когда мы выполняем какое-нибудь действие (отправка письма, назначение встречи, создание комментария или задачи, звонка и т.п.), то оно привязывается к соответствующей сущности, но только к одной из них.
Появилась задача: подготовить автоматические отчёты с рассылкой по e-mail сотрудникам определённых отделов в формате Excel с информацией по каким компаниям какие активности были.

ЧТО ДЕЛАЮТ СКРИПТЫ.
1. Выясняют через REST API к Битрикс24 каким сотрудникам необходимо отправить отчёт и по каким сотрудникам смотреть активности: по заданным ID подразделений составляется список сотрудников и руководителей подразделений.
2. Собирают все активности за интересующий период.
3. Собирают нужные данные по контактам, сделкам и компаниям по которым были выгружены активности.
4. Составляется таблица по компаниям и привязанным к ним активностям по всем возможным связям, например: в сделке имеется активность и указан контакт, контакт привязан к компании, значит активность относится к компании.
5. Формируют файлы Excel и рассылают.

УСТАНОВКА.
1. В окружении Python 3.6.x установить библиотеки requests, pandas, email.
2. Закинуть скрипты в папку.
3. В каждом файле в самом начале проверить опции.
4. Добавить в планировщик задач, cron к примеру.

СОДЕРЖИМОЕ.
Здесь три скрипта и файл с общими функциями для них.
1. mainCompaniesWithoutActivity.py
  Загружаются все активности за последние полгода (настраивается). Загружается список всех компаний. Составляется отчет по каким компаниям сколько дней не было активностей, какая была активность, кто ответственный по компании.
2. mainCompletedActivities.py
  Список всех активностей сотрудников отдела с привязкой к компаниям за 7 дней (настраивается).
3. mainExpiredActivities.py
  Список всех просроченных активностей сотрудников отдела с привязкой к компаниям за 7 дней (настраивается).
  
